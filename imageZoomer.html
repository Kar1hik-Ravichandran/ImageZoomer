<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Image Zoom Viewer</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", sans-serif;
        background: #0d0d0d;
        color: white;
        height: 100vh;
        overflow: hidden;
      }

      header {
        background: rgba(25, 25, 25, 0.9);
        backdrop-filter: blur(15px);
        display: flex;
        padding: 12px;
        gap: 12px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      header input {
        flex: 1;
        padding: 14px 16px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: #222;
        color: white;
        font-size: 16px;
        outline: none;
      }

      header input:focus {
        border-color: rgba(255, 255, 255, 0.3);
      }

      header button {
        padding: 14px 24px;
        background: #444;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: white;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      header button:hover {
        background: #555;
      }

      .viewer {
        position: relative;
        background: #000;
        height: calc(100vh - 76px);
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #zoom-img {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(1);
        cursor: grab;
        user-select: none;
        touch-action: none;
      }

      #zoom-img:active {
        cursor: grabbing;
      }

      .controls {
        position: absolute;
        top: 15px;
        right: 15px;
        display: flex;
        gap: 10px;
        z-index: 10;
      }

      .controls button {
        padding: 10px 12px;
        background: rgba(25, 25, 25, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        color: white;
        cursor: pointer;
        font-size: 16px;
      }

      .controls button:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .message {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(220, 38, 38, 0.9);
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        z-index: 20;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .message.show {
        opacity: 1;
      }

      .shortcuts {
        position: absolute;
        bottom: 15px;
        right: 15px;
        background: rgba(25, 25, 25, 0.9);
        backdrop-filter: blur(10px);
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 12px;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .shortcuts.show {
        opacity: 1;
      }

      .shortcuts div {
        margin-bottom: 4px;
      }

      .shortcuts kbd {
        background: rgba(255, 255, 255, 0.2);
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 11px;
      }

      .viewer:fullscreen {
        height: 100vh;
      }

      .viewer:fullscreen .controls {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
      }

      @media (max-width: 768px) {
        header {
          flex-direction: column;
        }

        .controls {
          flex-direction: column;
          top: 10px;
          right: 10px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <input type="text" id="image-url" placeholder="Paste image URL..." />
      <input type="file" id="file-input" accept="image/*" />
      <button onclick="app.loadImage()">Load URL</button>
    </header>

    <div class="viewer">
      <div class="controls">
        <button onclick="app.toggleFullscreen()" title="Fullscreen (F)">
          ⛶
        </button>
        <button onclick="app.resetZoom()" title="Reset (0)">↻</button>
      </div>

      <div class="message" id="message"></div>

      <div class="shortcuts" id="shortcuts">
        <div><kbd>+/-</kbd> Zoom</div>
        <div><kbd>0</kbd> Reset</div>
        <div><kbd>F</kbd> Fullscreen</div>
        <div><kbd>?</kbd> Help</div>
      </div>

      <img
        id="zoom-img"
        src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800"
        alt="Zoomable Image"
      />
    </div>

    <script>
      class ImageViewer {
        constructor() {
          this.img = document.getElementById("zoom-img");
          this.input = document.getElementById("image-url");
          this.fileInput = document.getElementById("file-input");
          this.message = document.getElementById("message");
          this.shortcuts = document.getElementById("shortcuts");

          this.scale = 1;
          this.minScale = 0.1;
          this.maxScale = 10;
          this.posX = 0;
          this.posY = 0;
          this.isDragging = false;
          this.lastX = 0;
          this.lastY = 0;
          this.lastTouchDistance = 0;

          this.init();
        }

        init() {
          this.bindEvents();
        }

        setTransform() {
          this.img.style.transform = `translate(-50%, -50%) translate(${this.posX}px, ${this.posY}px) scale(${this.scale})`;
        }

        clampScale(scale) {
          return Math.min(Math.max(scale, this.minScale), this.maxScale);
        }

        resetZoom() {
          this.scale = 1;
          this.posX = 0;
          this.posY = 0;
          this.setTransform();
        }

        showMessage(text, isError = true) {
          this.message.textContent = text;
          this.message.style.background = isError
            ? "rgba(220, 38, 38, 0.9)"
            : "rgba(34, 197, 94, 0.9)";
          this.message.classList.add("show");
          setTimeout(() => this.message.classList.remove("show"), 3000);
        }

        loadImage() {
          const url = this.input.value.trim();
          if (!url) {
            this.showMessage("Please enter a valid image URL");
            return;
          }

          const testImg = new Image();
          testImg.onload = () => {
            this.img.src = url;
            this.resetZoom();
            this.showMessage("Image loaded successfully!", false);
          };
          testImg.onerror = () => {
            this.showMessage("Failed to load image. Check the URL.");
          };
          testImg.src = url;
        }

        loadFile(file) {
          if (!file || !file.type.startsWith("image/")) {
            this.showMessage("Please select a valid image file");
            return;
          }

          const reader = new FileReader();
          reader.onload = (e) => {
            this.img.src = e.target.result;
            this.resetZoom();
            this.showMessage("File loaded successfully!", false);
          };
          reader.onerror = () => {
            this.showMessage("Failed to read the file");
          };
          reader.readAsDataURL(file);
        }

        getTouchDistance(touches) {
          const dx = touches[0].clientX - touches[1].clientX;
          const dy = touches[0].clientY - touches[1].clientY;
          return Math.sqrt(dx * dx + dy * dy);
        }

        async toggleFullscreen() {
          try {
            if (!document.fullscreenElement) {
              const viewer = document.querySelector(".viewer");
              await viewer.requestFullscreen();
            } else {
              await document.exitFullscreen();
            }
          } catch (err) {
            this.showMessage("Fullscreen not supported");
          }
        }

        bindEvents() {
          // File input
          this.fileInput.addEventListener("change", (e) => {
            if (e.target.files[0]) this.loadFile(e.target.files[0]);
          });

          // Mouse events
          this.img.addEventListener("mousedown", (e) => {
            e.preventDefault();
            this.isDragging = true;
            this.lastX = e.clientX;
            this.lastY = e.clientY;
          });

          window.addEventListener("mouseup", () => {
            this.isDragging = false;
          });

          window.addEventListener("mousemove", (e) => {
            if (!this.isDragging) return;
            this.posX += e.clientX - this.lastX;
            this.posY += e.clientY - this.lastY;
            this.lastX = e.clientX;
            this.lastY = e.clientY;
            this.setTransform();
          });

          // Wheel zoom
          this.img.addEventListener(
            "wheel",
            (e) => {
              e.preventDefault();
              const delta = e.deltaY < 0 ? 1.1 : 0.9;
              this.scale = this.clampScale(this.scale * delta);
              this.setTransform();
            },
            { passive: false }
          );

          // Touch events
          this.img.addEventListener(
            "touchstart",
            (e) => {
              if (e.touches.length === 1) {
                this.isDragging = true;
                this.lastX = e.touches[0].clientX;
                this.lastY = e.touches[0].clientY;
              } else if (e.touches.length === 2) {
                this.isDragging = false;
                this.lastTouchDistance = this.getTouchDistance(e.touches);
              }
            },
            { passive: true }
          );

          this.img.addEventListener(
            "touchmove",
            (e) => {
              e.preventDefault();
              if (e.touches.length === 1 && this.isDragging) {
                this.posX += e.touches[0].clientX - this.lastX;
                this.posY += e.touches[0].clientY - this.lastY;
                this.lastX = e.touches[0].clientX;
                this.lastY = e.touches[0].clientY;
                this.setTransform();
              } else if (e.touches.length === 2) {
                const distance = this.getTouchDistance(e.touches);
                if (this.lastTouchDistance > 0) {
                  const scaleFactor = distance / this.lastTouchDistance;
                  this.scale = this.clampScale(this.scale * scaleFactor);
                  this.setTransform();
                }
                this.lastTouchDistance = distance;
              }
            },
            { passive: false }
          );

          this.img.addEventListener("touchend", () => {
            this.isDragging = false;
            this.lastTouchDistance = 0;
          });

          // Keyboard shortcuts
          document.addEventListener("keydown", (e) => {
            if (e.target.tagName === "INPUT") return;

            switch (e.key) {
              case "+":
              case "=":
                e.preventDefault();
                this.scale = this.clampScale(this.scale + 0.2);
                this.setTransform();
                break;
              case "-":
                e.preventDefault();
                this.scale = this.clampScale(this.scale - 0.2);
                this.setTransform();
                break;
              case "0":
                e.preventDefault();
                this.resetZoom();
                break;
              case "f":
              case "F":
                e.preventDefault();
                this.toggleFullscreen();
                break;
              case "?":
                e.preventDefault();
                this.shortcuts.classList.toggle("show");
                break;
            }
          });

          // Enter key to load URL
          this.input.addEventListener("keydown", (e) => {
            if (e.key === "Enter") this.loadImage();
          });

          // Paste support
          document.addEventListener("paste", (e) => {
            const items = e.clipboardData?.items || [];
            for (let item of items) {
              if (item.type.indexOf("image") !== -1) {
                this.loadFile(item.getAsFile());
                break;
              }
            }
          });
        }
      }

      const app = new ImageViewer();
    </script>
  </body>
</html>
